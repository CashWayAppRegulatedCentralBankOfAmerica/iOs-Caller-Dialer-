<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment - Booking Confirmation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-lg mx-auto p-6 mt-10 bg-white rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold mb-6 text-center">Confirm Your Booking</h1>

    <form id="paymentForm" class="space-y-6">

      <input type="text" id="apartment" readonly class="hidden" />
      <input type="text" id="checkin" readonly class="hidden" />
      <input type="text" id="checkout" readonly class="hidden" />
      <input type="text" id="amount" readonly class="hidden" />

      <!-- Displayed fields -->
      <div>
        <label class="block font-semibold mb-1">Apartment</label>
        <div id="displayApartment" class="bg-gray-100 p-2 rounded"></div>
      </div>

      <div>
        <label class="block font-semibold mb-1">Dates</label>
        <div id="displayDates" class="bg-gray-100 p-2 rounded"></div>
      </div>

      <div>
        <label class="block font-semibold mb-1">Total Amount (USD)</label>
        <div id="displayAmount" class="bg-gray-100 p-2 rounded"></div>
      </div>

      <div>
        <label>Phone Number (+254...)</label>
        <input type="tel" id="phone" required placeholder="+254712345678" pattern="^\+\d{7,15}$"
          class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <div>
        <label>Email Address</label>
        <input type="email" id="email" required placeholder="your@email.com"
          class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <div>
        <label>Number of Guests</label>
        <select id="guests" required class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">Select</option>
          <option value="1">1 Guest</option>
          <option value="2">2 Guests</option>
        </select>
      </div>

      <div>
        <label>Check-in Time</label>
        <input type="time" id="checkintime" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <button type="submit"
        class="w-full bg-red-500 text-white py-3 rounded hover:bg-red-600 transition">Proceed to Payment</button>
    </form>
  </div>

  <!-- MODAL -->
  <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg w-96 space-y-4">
      <h2 class="text-xl font-bold text-center">Choose Payment Method</h2>
      <div class="text-center">
        <button id="paypalBtn" class="bg-blue-600 text-white w-full py-2 rounded hover:bg-blue-700">Pay with PayPal</button>
        <button id="mpesaBtn" class="bg-green-600 text-white w-full py-2 mt-3 rounded hover:bg-green-700">Pay with MPESA</button>
      </div>
      <div class="text-sm text-center text-gray-500 cursor-pointer" onclick="closeModal()">Cancel</div>
    </div>
  </div>

  <!-- MPESA Instructions Modal -->
  <div id="mpesaModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg w-96 space-y-4">
      <h2 class="text-lg font-bold text-center text-green-700">Lipa Na MPESA</h2>
      <ul class="text-gray-700 text-sm space-y-2">
        <li>Go to MPESA Menu</li>
        <li>Select **Lipa na MPESA**</li>
        <li>Choose **Paybill**</li>
        <li>Business Number: <strong>123456</strong></li>
        <li>Account Number: <strong id="mpesaAccount"></strong></li>
        <li>Amount: <strong id="mpesaAmount"></strong></li>
      </ul>
      <div class="text-center mt-4">
        <button onclick="closeModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Done</button>
      </div>
    </div>
  </div>

  <script>
    // Fetch URL params
    const params = new URLSearchParams(window.location.search);
    const apartment = params.get("apartment") || "N/A";
    const checkin = params.get("checkin") || "N/A";
    const checkout = params.get("checkout") || "N/A";
    const amount = params.get("amount") || "0";

    document.getElementById("apartment").value = apartment;
    document.getElementById("checkin").value = checkin;
    document.getElementById("checkout").value = checkout;
    document.getElementById("amount").value = amount;

    // Display to user
    document.getElementById("displayApartment").textContent = apartment;
    document.getElementById("displayDates").textContent = `${checkin} to ${checkout}`;
    document.getElementById("displayAmount").textContent = `$${amount}`;

    const form = document.getElementById("paymentForm");
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      // Basic validation
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const guests = document.getElementById("guests").value;
      const checkintime = document.getElementById("checkintime").value;

      if (!/^\+\d{7,15}$/.test(phone)) {
        alert("Phone number must start with + and contain 7â€“15 digits.");
        return;
      }

      if (!email.includes("@")) {
        alert("Invalid email address.");
        return;
      }

      if (!guests || !checkintime) {
        alert("Fill all fields.");
        return;
      }

      // All good, show payment modal
      document.getElementById("paymentModal").classList.remove("hidden");
    });

    function closeModal() {
      document.getElementById("paymentModal").classList.add("hidden");
      document.getElementById("mpesaModal").classList.add("hidden");
    }

    // Handle PayPal
    document.getElementById("paypalBtn").addEventListener("click", () => {
      // Redirect to PayPal (replace this with your actual PayPal API logic)
      const url = `https://www.paypal.com/your-api-link?amount=${amount}&item_name=${encodeURIComponent(apartment)}`;
      window.location.href = url;
    });

    // Handle MPESA
    document.getElementById("mpesaBtn").addEventListener("click", () => {
      document.getElementById("paymentModal").classList.add("hidden");
      document.getElementById("mpesaModal").classList.remove("hidden");

      document.getElementById("mpesaAccount").textContent = apartment.replace(/\s+/g, "").toUpperCase();
      document.getElementById("mpesaAmount").textContent = `$${amount}`;
    });
  </script>
</body>
</html>
